# AUTOMATICALLY GENERATED - DO NOT EDIT
# Generated by remnawave-ansible-gen
#
# Example: Complete infrastructure teardown workflow
# Deletes nodes first, then the config profile
# Usage: ansible-playbook teardown_infrastructure.yml -e @../vars/example_vars.yml
---
- name: Teardown Remnawave Infrastructure
  hosts: localhost
  gather_facts: false
  vars_files:
    - ../vars/example_vars.yml

  tasks:
    # =========================================
    # Step 1: Delete Nodes
    # Nodes must be deleted before the config profile
    # =========================================

    - name: Delete node
      ilyagulya.remnawave.node:
        panel_url: "{{ '{{' }} remnawave_panel_url {{ '}}' }}"
        api_token: "{{ '{{' }} remnawave_api_token {{ '}}' }}"
        state: absent
        name: "{{ '{{' }} node_name {{ '}}' }}"
      register: node_result

    - name: Display node deletion result
      ansible.builtin.debug:
        msg: "Node '{{ '{{' }} node_name {{ '}}' }}' deletion: {{ '{{' }} 'deleted' if node_result.changed else 'already absent' {{ '}}' }}"

    # =========================================
    # Step 2: Delete Config Profile
    # =========================================

    - name: Delete config profile
      ilyagulya.remnawave.config_profile:
        panel_url: "{{ '{{' }} remnawave_panel_url {{ '}}' }}"
        api_token: "{{ '{{' }} remnawave_api_token {{ '}}' }}"
        state: absent
        name: "{{ '{{' }} config_profile_name {{ '}}' }}"
      register: profile_result

    - name: Display profile deletion result
      ansible.builtin.debug:
        msg: "Profile '{{ '{{' }} config_profile_name {{ '}}' }}' deletion: {{ '{{' }} 'deleted' if profile_result.changed else 'already absent' {{ '}}' }}"

    # =========================================
    # Summary
    # =========================================

    - name: Infrastructure teardown summary
      ansible.builtin.debug:
        msg:
          - "Infrastructure teardown complete!"
          - "Node deleted: {{ '{{' }} node_result.changed {{ '}}' }}"
          - "Config profile deleted: {{ '{{' }} profile_result.changed {{ '}}' }}"
